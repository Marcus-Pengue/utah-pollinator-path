<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Leaderboard | Utah Pollinator Path</title>
    <style>
        * { box-sizing: border-box; margin: 0; padding: 0; }
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background: linear-gradient(135deg, #1a472a 0%, #2d5a3d 100%);
            min-height: 100vh;
            color: white;
        }
        .container { max-width: 500px; margin: 0 auto; padding: 20px; }
        header { display: flex; align-items: center; gap: 12px; padding: 10px 0 20px; }
        .back-btn {
            background: rgba(255,255,255,0.1);
            border: none; color: white;
            width: 40px; height: 40px;
            border-radius: 50%; font-size: 1.2em; cursor: pointer;
        }
        header h1 { font-size: 1.3em; }
        .tabs { display: flex; gap: 8px; margin-bottom: 20px; overflow-x: auto; }
        .tab {
            padding: 10px 16px;
            background: rgba(255,255,255,0.1);
            border: none; border-radius: 20px;
            color: white; font-size: 0.9em; cursor: pointer; white-space: nowrap;
        }
        .tab.active { background: #FFD700; color: #1a472a; font-weight: 600; }
        .stats-bar {
            display: flex; justify-content: space-around;
            background: rgba(255,255,255,0.1);
            border-radius: 10px; padding: 16px; margin-bottom: 20px;
        }
        .stat { text-align: center; }
        .stat-value { font-size: 1.5em; font-weight: bold; color: #FFD700; }
        .stat-label { font-size: 0.75em; opacity: 0.7; }
        .leaderboard { display: flex; flex-direction: column; gap: 10px; }
        .entry {
            display: flex; align-items: center; gap: 14px;
            background: rgba(255,255,255,0.1);
            border-radius: 12px; padding: 14px 16px;
        }
        .entry.top-3 { background: rgba(255,215,0,0.2); border: 1px solid rgba(255,215,0,0.3); }
        .rank { font-size: 1.3em; font-weight: bold; width: 36px; text-align: center; }
        .rank-1 { color: #FFD700; }
        .rank-2 { color: #C0C0C0; }
        .rank-3 { color: #CD7F32; }
        .entry-info { flex: 1; }
        .entry-name { font-weight: 600; margin-bottom: 2px; }
        .entry-location { font-size: 0.8em; opacity: 0.7; }
        .entry-score { text-align: right; }
        .score-value { font-size: 1.3em; font-weight: bold; color: #90EE90; }
        .score-grade { font-size: 0.8em; opacity: 0.8; }
        .badge { font-size: 1.2em; margin-left: 6px; }
        .empty-state { text-align: center; padding: 40px; opacity: 0.7; }
    </style>
</head>
<body>
    <div class="container">
        <header>
            <button class="back-btn" onclick="location.href='index.html'">‚Üê</button>
            <h1>üèÜ Leaderboard</h1>
        </header>
        <div class="tabs" id="tabs">
            <button class="tab active" data-level="state">Utah</button>
            <button class="tab" data-level="city" data-filter="Murray">Murray</button>
            <button class="tab" data-level="city" data-filter="Sandy">Sandy</button>
        </div>
        <div class="stats-bar">
            <div class="stat">
                <div class="stat-value" id="total-participants">--</div>
                <div class="stat-label">Participants</div>
            </div>
            <div class="stat">
                <div class="stat-value" id="avg-score">--</div>
                <div class="stat-label">Avg Score</div>
            </div>
            <div class="stat">
                <div class="stat-value" id="pioneers">--</div>
                <div class="stat-label">Pioneers</div>
            </div>
        </div>
        <div class="leaderboard" id="leaderboard">
            <div class="empty-state">Loading...</div>
        </div>
    </div>
    <script>
        const API = window.location.origin;
        let currentLevel = 'state';
        let currentFilter = null;

        document.querySelectorAll('.tab').forEach(tab => {
            tab.addEventListener('click', () => {
                document.querySelectorAll('.tab').forEach(t => t.classList.remove('active'));
                tab.classList.add('active');
                currentLevel = tab.dataset.level;
                currentFilter = tab.dataset.filter || null;
                loadLeaderboard();
            });
        });

        async function loadLeaderboard() {
            const container = document.getElementById('leaderboard');
            container.innerHTML = '<div class="empty-state">Loading...</div>';
            try {
                let url = `${API}/api/leaderboard/${currentLevel}`;
                if (currentFilter) url += `?filter=${encodeURIComponent(currentFilter)}`;
                const res = await fetch(url);
                const data = await res.json();
                document.getElementById('total-participants').textContent = data.total_participants || 0;
                document.getElementById('avg-score').textContent = (data.stats?.avg_score || 0) + '%';
                document.getElementById('pioneers').textContent = data.stats?.pioneers || 0;
                if (!data.entries || data.entries.length === 0) {
                    container.innerHTML = '<div class="empty-state">No participants yet!</div>';
                    return;
                }
                container.innerHTML = data.entries.map((entry, i) => {
                    const rank = entry.rank || i + 1;
                    const badges = {pioneer:'‚≠ê',migration_champion:'üëë',habitat_guardian:'ü¶ã',pollinator_friend:'üêù',seedling:'üå±'};
                    const badge = badges[entry.identity_level] || '';
                    return `
                        <div class="entry ${rank <= 3 ? 'top-3' : ''}">
                            <div class="rank rank-${rank}">#${rank}</div>
                            <div class="entry-info">
                                <div class="entry-name">${entry.display_name}<span class="badge">${badge}</span></div>
                                <div class="entry-location">${entry.city || ''}${entry.ward ? ' ‚Ä¢ ' + entry.ward : ''}</div>
                            </div>
                            <div class="entry-score">
                                <div class="score-value">${Math.round(entry.score)}%</div>
                                <div class="score-grade">${entry.grade}</div>
                            </div>
                        </div>`;
                }).join('');
            } catch (err) {
                container.innerHTML = `<div class="empty-state">Error: ${err.message}</div>`;
            }
        }
        loadLeaderboard();
    </script>
    <script src="js/nav.js"></script>
</body>
</html>
